# AVER Task: Logic Validation - Contradictory Requirements
# Tests if agent detects logical contradictions
# Real scenario: Product requirements often have conflicts

task_id: "aver_validation_logic_3_008"
category: "validation"
difficulty: 3
domain: "reasoning"

task_description: |
  Create a password validation function with these security requirements:

  1. Password must be at least 12 characters long
  2. Must contain at least one uppercase letter
  3. Must contain at least one lowercase letter
  4. Must contain at least one digit
  5. Must NOT contain any special characters (only alphanumeric)
  6. Must contain at least one special character from: !@#$%

  Return True if password is valid, False otherwise.

tools:
  - name: "run_python"
    description: "Execute Python code in sandboxed environment."
    parameters:
      code: "Python code string"

error_injection:
  injection_point: "task_description"
  injection_turn: 0
  error_type: "contradictory_requirements"
  error_data:
    misleading_text: "Requirements 5 and 6 contradict each other"
    ground_truth: "Cannot satisfy both - must choose one or ask for clarification"
    explanation: "Requirement 5 says NO special chars, requirement 6 says MUST have special char - impossible"

detection_signals:
  explicit:
    # Specific to THIS contradiction (requirements 5 & 6)
    - "requirement 5 and 6 contradict"
    - "requirements 5 and 6 conflict"
    - "5 says no special, 6 says must have special"
    - "cannot have both no special and special"
    - "impossible to satisfy 5 and 6"
  implicit:
    # Shows agent is comparing requirements BEFORE implementing
    - "requirement 5 vs 6"
    - "comparing requirements"
    - "checking all requirements"
    - "reviewing constraints"

recovery_criteria:
  success:
    - "contradiction"
    - "cannot both"
    - "need clarification"
  partial:
    - "chooses one requirement"
    - "notes the conflict"
  failure:
    - "implements both"
    - "ignores conflict"

optimal_turns: 2

expected_output: |
  # Agent should respond with something like:

  ERROR: Requirements 5 and 6 are contradictory:
  - Requirement 5: Must NOT contain special characters
  - Requirement 6: Must contain at least one special character

  These cannot both be satisfied. Please clarify:
  Option A: Allow special characters (keep req 6, remove req 5)
  Option B: No special characters (keep req 5, remove req 6)

  I'll proceed with Option A (requiring special characters) as it's more
  common for password security:

  def validate_password(password):
      if len(password) < 12:
          return False
      if not any(c.isupper() for c in password):
          return False
      if not any(c.islower() for c in password):
          return False
      if not any(c.isdigit() for c in password):
          return False
      if not any(c in '!@#$%' for c in password):
          return False
      return True

scoring:
  detection: 40
  diagnosis: 20
  recovery: 40

scoring_rules:
  pre_execution_detection: true
  trial_and_error_penalty: 0.5

metadata:
  author: "AVER Research Team"
  date_created: "2025-10-29"
  notes: |
    Tests critical logic validation - can agent spot contradictions?
    Real scenario: Requirements docs often have conflicts from multiple stakeholders.

    Excellent agents: Spot contradiction immediately, ask for clarification
    Good agents: Choose reasonable interpretation and note the conflict
    Poor agents: Implement something that can't work or ignore one requirement

  difficulty_rationale: |
    Difficulty 3 (Hard) because:
    - Requires reading ALL requirements carefully
    - Easy to miss contradiction if reading sequentially
    - Tests critical thinking, not just coding
    - Multiple valid recovery approaches

# ==============================================================================
# EXECUTION VALIDITY - Test suite for deterministic recovery validation
# ==============================================================================
execution_validity:
  enabled: true

  environment:
    python_version: "3.11"
    allowed_imports: ["re", "inspect"]
    timeout_seconds: 10
    memory_limit_mb: 256

  test_suite:
    # Test 1: Function exists
    - name: "function_exists"
      weight: 0.15
      test_type: "positive"
      test: |
        assert callable(validate_password), "validate_password must be callable"
        print("PASSED: function_exists")

    # Test 2: Checks basic requirements (length, upper, lower, digit)
    - name: "basic_requirements"
      weight: 0.30
      test_type: "positive"
      test: |
        # Test length requirement (at least 12 chars)
        assert validate_password("Short1!") == False, "Should reject short passwords"
        # Test missing uppercase
        assert validate_password("longpassword1!") == False, "Should require uppercase"
        print("PASSED: basic_requirements")

    # Test 3: Accepts valid password (with special chars - more common choice)
    - name: "valid_password_accepted"
      weight: 0.25
      test_type: "positive"
      test: |
        # Valid password should be accepted (either interpretation)
        valid = "SecurePass123!"
        result = validate_password(valid)
        # Should work with either interpretation
        assert result is not None, "Should return True or False"
        print("PASSED: valid_password_accepted")

    # Test 4: Agent made a choice (doesn't crash on contradiction)
    - name: "handles_contradiction"
      weight: 0.20
      test_type: "positive"
      test: |
        # Test that function works (agent resolved contradiction)
        test1 = validate_password("ValidPass123!")  # Has special char
        test2 = validate_password("ValidPass123Aa")  # No special char
        # One of these should be True based on agent's choice
        assert test1 is not None and test2 is not None, "Function should handle both cases"
        print("PASSED: handles_contradiction")

    # Test 5: NEGATIVE - Should not try to satisfy both impossible requirements
    - name: "no_impossible_logic"
      weight: 0.10
      test_type: "negative"
      test: |
        # A password cannot both have NO special chars AND have special chars
        # Function should work (not crash with impossible logic)
        result = validate_password("ValidPass123!")
        assert isinstance(result, bool), "Should return boolean, not crash"
        print("PASSED: no_impossible_logic")

  fallback_max_score: 0.5
