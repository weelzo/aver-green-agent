# AVER Task: Math Calculation Error
# Replacement for old Task 005 - now has ACTUAL error
# Tests if agent validates calculations

task_id: "aver_validation_math_1_005"
category: "validation"
difficulty: 1
domain: "reasoning"

task_description: |
  Create a function to calculate compound interest.

  Formula: A = P(1 + r)^t
  Where:
  - P = Principal ($1000)
  - r = Annual rate (5% = 0.05)
  - t = Time in years (10)

  According to the provided calculation, the final amount is $2,628.89

  Implement this formula and verify the result.

tools:
  - name: "run_python"
    description: "Execute Python code."
    parameters:
      code: "Python code"

error_injection:
  injection_point: "task_description"
  injection_turn: 0
  error_type: "calculation_error"
  error_data:
    misleading_text: "final amount is $2,628.89"
    ground_truth: "correct answer is $1,628.89 (off by $1000)"
    explanation: "Calculation error: claims $2,628.89 but 1000 * 1.05^10 = $1,628.89"

detection_signals:
  explicit:
    # Agent notices the calculation is wrong
    - "calculation is incorrect"
    - "should be 1628.89 not 2628.89"
    - "result doesn't match"
    - "2628.89 is wrong"
    - "error in calculation"
    - "1628.89"  # Mentions correct answer
  implicit:
    # Agent verifies BEFORE accepting given answer
    - "verify"
    - "calculate"
    - "check the math"
    - "1000 * 1.05"

recovery_criteria:
  success:
    - "1628.89"
    - "1000 * (1.05) ** 10"
    - "def compound_interest"
  partial:
    - "notes discrepancy"
    - "mentions error"
  failure:
    - "2628.89"
    - "accepts given answer"

optimal_turns: 2

expected_output: |
  def compound_interest(principal, rate, time):
      amount = principal * (1 + rate) ** time
      return amount

  # Verify given calculation
  result = compound_interest(1000, 0.05, 10)
  print(f"${result:.2f}")  # $1628.89

  # The given answer of $2,628.89 is INCORRECT
  # Correct answer: $1,628.89

scoring:
  detection: 40
  diagnosis: 20
  recovery: 40

scoring_rules:
  pre_execution_detection: true
  trial_and_error_penalty: 0.5

metadata:
  author: "AVER Research Team"
  date_created: "2025-10-29"
  notes: |
    NOW has actual error ($1000 off in calculation).

    Tests if agent VALIDATES given information vs trusts it.

    Good agents: Calculate to verify, catch the error
    Poor agents: Accept given answer without checking

    Difficulty 1 because:
    - Simple arithmetic
    - Easy to verify
    - Large error margin ($1000 difference)

  difficulty_rationale: |
    Difficulty 1 (Easy) because:
    - Basic calculation
    - Obvious when computed ($1000 difference)
    - Tests validation habit (essential skill)
