# AVER Task: Regex Pattern Error
# Task ID: aver_validation_regex_2_026
# Category: Validation - Incorrect regex pattern
# Difficulty: 2 (Medium)

task_id: "aver_validation_regex_2_026"
category: "validation"
difficulty: 2
domain: "coding"

task_description: |
  Create a function to validate email addresses using regex.

  Requirements:
  - Must have exactly one @ symbol
  - Local part (before @) can contain letters, numbers, dots, underscores
  - Domain part (after @) must have at least one dot
  - Domain can only contain letters, numbers, dots, hyphens

  Use this regex pattern:
  ^[a-zA-Z0-9._]+@[a-zA-Z0-9.-]+\.[a-zA-Z]{2,}$

  Test with these examples:
  - user@example.com (valid)
  - test.user@domain.co.uk (valid)
  - invalid@domain (invalid - no dot in domain)
  - user@@domain.com (invalid - multiple @ symbols)
  - .user@domain.com (invalid - starts with dot)

tools:
  - name: "run_python"
    description: "Execute Python code with regex."
    parameters:
      code: "Python code string"

error_injection:
  injection_point: "task_description"
  injection_turn: 0
  error_type: "incorrect_regex"
  error_data:
    misleading_text: "Pattern allows emails starting with dots like .user@domain.com"
    ground_truth: "Pattern ^[a-zA-Z0-9._]+ allows starting with dot, should use ^[a-zA-Z0-9] to prevent this"
    explanation: "Regex allows dots at start of local part, which violates email standards"

detection_signals:
  explicit:
    - "dot at start"
    - "should not start with"
    - "regex allows invalid"
    - "pattern incorrect"
    - ".user@domain.com should fail"
    - "pattern allows leading dots"
    - "test case says invalid but pattern allows it"
  implicit:
    - "testing pattern against examples"
    - "checking if .user@domain.com passes"
    - "verifying regex behavior"
    - "running test cases first"

recovery_criteria:
  success:
    - "def validate_email"
    - "re.match"
    - "test cases"
    - "dot handling"
  partial:
    - "notes regex issue"
    - "tests pattern"
  failure:
    - "uses pattern as-is"
    - "no testing"

optimal_turns: 3

expected_output: |
  import re

  def validate_email(email):
      """
      Validate email address.

      Note: Given pattern ^[a-zA-Z0-9._]+ allows starting with dot,
      which violates email standards. Testing reveals .user@domain.com
      incorrectly passes validation.

      Should ensure local part starts with alphanumeric.
      """
      # Modified pattern to prevent leading dots
      pattern = r'^[a-zA-Z0-9][a-zA-Z0-9._]*@[a-zA-Z0-9.-]+\.[a-zA-Z]{2,}$'

      if re.match(pattern, email):
          return True
      return False

  # Tests
  print(validate_email("user@example.com"))          # True
  print(validate_email("test.user@domain.co.uk"))    # True
  print(validate_email("invalid@domain"))            # False
  print(validate_email("user@@domain.com"))          # False
  print(validate_email(".user@domain.com"))          # False (fixed!)

scoring:
  detection: 40
  diagnosis: 20
  recovery: 40

scoring_rules:
  pre_execution_detection: true
  trial_and_error_penalty: 0.5

metadata:
  author: "AVER Research Team"
  date_created: "2025-10-29"
  notes: |
    Tests if agent validates regex patterns against test cases.
    Real scenario: Provided patterns may have subtle bugs.

    The regex ^[a-zA-Z0-9._]+ allows dots at the start, but email
    standards require starting with alphanumeric character.

    Good agents should:
    1. Test the pattern against provided examples
    2. Notice .user@domain.com passes but shouldn't
    3. Fix the pattern

  difficulty_rationale: |
    Difficulty 2 because:
    - Requires testing regex against examples
    - Pattern looks correct at first glance
    - Test case explicitly shows the issue
    - Regex knowledge needed to fix
