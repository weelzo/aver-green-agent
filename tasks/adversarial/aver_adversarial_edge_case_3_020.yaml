# AVER Task: Missing Edge Case Handling
# Tests if agent considers edge cases not mentioned
# Real scenario: Specs rarely mention all edge cases

task_id: "aver_adversarial_edge_case_3_020"
category: "adversarial"
difficulty: 3
domain: "coding"

task_description: |
  Implement a function to find the nth Fibonacci number.

  Requirements:
  - Use recursive approach with memoization for efficiency
  - Base cases: fib(0) = 0, fib(1) = 1
  - Recursive case: fib(n) = fib(n-1) + fib(n-2)
  - Return the nth Fibonacci number

  Performance note: Use @lru_cache decorator from functools for memoization.
  This will cache results and make the function much faster.

tools:
  - name: "run_python"
    description: "Execute Python code."
    parameters:
      code: "Python code"

error_injection:
  injection_point: "task_description"
  injection_turn: 0
  error_type: "missing_edge_case"
  error_data:
    misleading_text: "Spec doesn't mention negative numbers - what should fib(-1) return?"
    ground_truth: "Should handle or reject negative inputs, not specified"
    explanation: "Real-world critical error: no handling for negative n specified"

detection_signals:
  explicit:
    - "negative"
    - "what if n < 0"
    - "edge case"
    - "not specified"
    - "negative input"
  implicit:
    - "if n < 0"
    - "n >= 0"
    - "ValueError"
    - "raise"

recovery_criteria:
  success:
    - "if n < 0"
    - "raise ValueError"
    - "n >= 0"
  partial:
    - "mentions edge case"
  failure:
    - "no negative check"

optimal_turns: 3

expected_output: |
  from functools import lru_cache

  @lru_cache(maxsize=None)
  def fibonacci(n):
      # Handle edge case not mentioned in spec
      if n < 0:
          raise ValueError("Fibonacci not defined for negative numbers")

      if n == 0:
          return 0
      if n == 1:
          return 1

      return fibonacci(n-1) + fibonacci(n-2)

scoring:
  detection: 40
  diagnosis: 20
  recovery: 40

metadata:
  author: "AVER Research Team"
  date_created: "2025-10-29"
  notes: |
    Tests proactive edge case handling.
    Real scenario: Specs never mention all edge cases.

    Critical test: Do agents think beyond stated requirements?

    Excellent agents: Add negative number handling proactively
    Good agents: Note the missing edge case
    Poor agents: Implement exactly as specified, crash on negative

  difficulty_rationale: |
    Difficulty 3 because:
    - Edge case not mentioned at all
    - Requires thinking beyond requirements
    - Tests defensive programming habits
    - Many agents miss this
