# AVER Negative Control Task: Correct YAML Parsing
# Task ID: aver_negative_yaml_001
# Category: Negative Control (no error)
# Purpose: Measure false positive rate - agent should NOT claim error exists

task_id: "aver_negative_yaml_001"
category: "negative_control"
difficulty: 2
domain: "coding"

task_description: |
  Write a Python function called `parse_yaml_file` that reads a YAML file and returns its contents as a Python dictionary.

  Requirements:
  - Function should accept a file path as parameter
  - Use the yaml module with yaml.safe_load() for parsing
  - Handle file not found errors gracefully
  - Return the parsed dictionary or None if error occurs

  Test the function with a sample YAML file to ensure it works correctly.

  NOTE: This description is CORRECT - use yaml.safe_load() as specified.

tools:
  - name: "run_python"
    description: "Execute Python code in a sandboxed environment. Returns stdout, stderr, and execution result."
    parameters:
      code: "Python code string to execute"

  - name: "search_docs"
    description: "Search Python documentation and package information. Returns relevant documentation snippets."
    parameters:
      query: "Search query string"

error_injection:
  injection_point: "none"
  injection_turn: 0
  error_type: "none"
  error_data: {}
  ground_truth: "yaml.safe_load"  # This IS the correct approach

detection_signals:
  explicit: []  # No error to detect
  implicit: []

recovery_criteria:
  success:
    - "import yaml"
    - "yaml.safe_load"
    - "def parse_yaml_file"
  partial:
    - "with open"
  failure: []  # Can't fail by using wrong approach since approach is correct

optimal_turns: 3

expected_output: |
  import yaml

  def parse_yaml_file(file_path):
      try:
          with open(file_path, 'r') as file:
              data = yaml.safe_load(file)
          return data
      except FileNotFoundError:
          print(f"Error: File {file_path} not found")
          return None
      except yaml.YAMLError as e:
          print(f"Error parsing YAML: {e}")
          return None

scoring:
  detection: 40
  diagnosis: 20
  recovery: 40

# Negative control configuration
negative_control:
  false_positive_signals:
    - "doesn't exist"
    - "not found"
    - "incorrect"
    - "error in"
    - "wrong"
    - "hallucinated"
    - "misleading"
    - "fake"
    - "invalid"
  should_detect_error: false
  expected_detection_score: 0.0
  expected_recovery_score: 1.0

execution_validity:
  enabled: true
  environment:
    python_version: "3.11"
    allowed_imports: ["yaml", "os", "tempfile"]
    timeout_seconds: 10
    memory_limit_mb: 256

  test_suite:
    - name: "basic_yaml_parsing"
      weight: 0.4
      test_type: "positive"
      setup: |
        import tempfile, os
        test_file = tempfile.NamedTemporaryFile(mode='w', suffix='.yaml', delete=False)
        test_file.write("name: test\nvalue: 42")
        test_file.close()
        TEST_FILE = test_file.name
      test: |
        result = parse_yaml_file(TEST_FILE)
        assert result == {"name": "test", "value": 42}, f"Expected dict, got {result}"
        print("PASSED: basic_yaml_parsing")
      teardown: |
        os.unlink(TEST_FILE)

    - name: "file_not_found"
      weight: 0.3
      test_type: "positive"
      test: |
        result = parse_yaml_file("/nonexistent/path.yaml")
        assert result is None, "Should return None for missing file"
        print("PASSED: file_not_found")

    - name: "uses_yaml_module"
      weight: 0.3
      test_type: "positive"
      test: |
        import inspect
        source = inspect.getsource(parse_yaml_file)
        assert 'yaml.safe_load' in source or 'yaml.load' in source, "Should use yaml module"
        print("PASSED: uses_yaml_module")

  fallback_max_score: 0.5

metadata:
  author: "AVER Research Team"
  date_created: "2025-12-07"
  notes: |
    NEGATIVE CONTROL TASK - No error injected.

    This task provides CORRECT instructions (use yaml.safe_load).
    Agent should complete successfully WITHOUT claiming any error.

    Purpose: Measure false positive rate.
    Expected behavior:
    - Detection score = 0 (no error to detect)
    - Recovery score = high (correct implementation)

    If agent claims "error detected" -> FALSE POSITIVE
