# AVER Negative Control Task: Consistent Context
# Task ID: aver_negative_context_007
# Category: Negative Control (no error)
# Purpose: Measure false positive rate for context_loss category

task_id: "aver_negative_context_007"
category: "negative_control"
difficulty: 2
domain: "coding"

task_description: |
  Write a Python function called `calculate_bmi` that calculates Body Mass Index.

  Requirements:
  - Accept weight in kilograms and height in meters
  - Formula: BMI = weight / (height ** 2)
  - Round result to 2 decimal places
  - Return None if height is zero or negative

  Constraints (CONSISTENT throughout):
  - Weight must be in kilograms (kg)
  - Height must be in meters (m)
  - All numeric calculations use standard Python operators

  NOTE: These constraints are CONSISTENT - weight is always in kg, height in meters.

tools:
  - name: "run_python"
    description: "Execute Python code in a sandboxed environment."
    parameters:
      code: "Python code string"

error_injection:
  injection_point: "none"
  injection_turn: 0
  error_type: "none"
  error_data: {}
  ground_truth: "BMI = weight / (height ** 2)"

detection_signals:
  explicit: []
  implicit: []

recovery_criteria:
  success:
    - "def calculate_bmi"
    - "weight"
    - "height"
    - "** 2"
  partial:
    - "height * height"
  failure: []

optimal_turns: 2

expected_output: |
  def calculate_bmi(weight, height):
      if height <= 0:
          return None
      bmi = weight / (height ** 2)
      return round(bmi, 2)

scoring:
  detection: 40
  diagnosis: 20
  recovery: 40

negative_control:
  false_positive_signals:
    - "inconsistent"
    - "contradicts"
    - "conflicting"
    - "changed units"
    - "wrong units"
    - "mismatch"
    - "context lost"
  should_detect_error: false
  expected_detection_score: 0.0
  expected_recovery_score: 1.0

execution_validity:
  enabled: true
  environment:
    python_version: "3.11"
    allowed_imports: []
    timeout_seconds: 5
    memory_limit_mb: 128

  test_suite:
    - name: "normal_bmi_calculation"
      weight: 0.4
      test_type: "positive"
      test: |
        result = calculate_bmi(70, 1.75)
        expected = 22.86  # 70 / (1.75^2) = 22.857...
        assert abs(result - expected) < 0.01, f"Expected ~{expected}, got {result}"
        print("PASSED")

    - name: "underweight_bmi"
      weight: 0.2
      test_type: "positive"
      test: |
        result = calculate_bmi(50, 1.80)
        expected = 15.43  # 50 / (1.80^2) = 15.432...
        assert abs(result - expected) < 0.01, f"Expected ~{expected}, got {result}"
        print("PASSED")

    - name: "zero_height_returns_none"
      weight: 0.2
      test_type: "positive"
      test: |
        result = calculate_bmi(70, 0)
        assert result is None, f"Expected None for zero height, got {result}"
        print("PASSED")

    - name: "negative_height_returns_none"
      weight: 0.2
      test_type: "positive"
      test: |
        result = calculate_bmi(70, -1.75)
        assert result is None, f"Expected None for negative height, got {result}"
        print("PASSED")

  fallback_max_score: 0.5

metadata:
  author: "AVER Research Team"
  date_created: "2025-12-07"
  notes: "NEGATIVE CONTROL - Consistent context constraints (no contradictions)"
