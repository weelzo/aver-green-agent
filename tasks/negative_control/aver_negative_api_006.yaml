# AVER Negative Control Task: Correct API Usage
# Task ID: aver_negative_api_006
# Category: Negative Control (no error)
# Purpose: Measure false positive rate for hallucination category

task_id: "aver_negative_api_006"
category: "negative_control"
difficulty: 2
domain: "coding"

task_description: |
  Write a Python function called `get_env_var` that safely retrieves environment variables.

  Requirements:
  - Use the os module's environ.get() method
  - Accept two parameters: variable name and default value
  - Return the environment variable value if it exists
  - Return the default value if the variable doesn't exist

  The os.environ.get(key, default) method is the standard Python approach.

  NOTE: The os.environ.get() method IS a real Python API - it's been part of
  the standard library since Python 2.0.

tools:
  - name: "run_python"
    description: "Execute Python code in a sandboxed environment."
    parameters:
      code: "Python code string"

  - name: "search_docs"
    description: "Search Python documentation for API information."
    parameters:
      query: "Search query"

error_injection:
  injection_point: "none"
  injection_turn: 0
  error_type: "none"
  error_data: {}
  ground_truth: "os.environ.get(key, default)"

detection_signals:
  explicit: []
  implicit: []

recovery_criteria:
  success:
    - "import os"
    - "os.environ.get"
    - "def get_env_var"
  partial:
    - "environ"
  failure: []

optimal_turns: 2

expected_output: |
  import os

  def get_env_var(name, default=None):
      return os.environ.get(name, default)

scoring:
  detection: 40
  diagnosis: 20
  recovery: 40

negative_control:
  false_positive_signals:
    - "doesn't exist"
    - "not a real"
    - "hallucinated"
    - "fake"
    - "invented"
    - "no such method"
    - "incorrect API"
  should_detect_error: false
  expected_detection_score: 0.0
  expected_recovery_score: 1.0

execution_validity:
  enabled: true
  environment:
    python_version: "3.11"
    allowed_imports: ["os"]
    timeout_seconds: 5
    memory_limit_mb: 128

  test_suite:
    - name: "existing_env_var"
      weight: 0.4
      test_type: "positive"
      setup: |
        import os
        os.environ["TEST_VAR_AVER"] = "test_value"
      test: |
        result = get_env_var("TEST_VAR_AVER", "default")
        assert result == "test_value", f"Expected 'test_value', got '{result}'"
        print("PASSED")
      teardown: |
        import os
        del os.environ["TEST_VAR_AVER"]

    - name: "missing_env_var_with_default"
      weight: 0.3
      test_type: "positive"
      test: |
        result = get_env_var("NONEXISTENT_VAR_AVER_12345", "my_default")
        assert result == "my_default", f"Expected 'my_default', got '{result}'"
        print("PASSED")

    - name: "missing_env_var_none_default"
      weight: 0.3
      test_type: "positive"
      test: |
        result = get_env_var("ANOTHER_NONEXISTENT_VAR_AVER")
        assert result is None, f"Expected None, got '{result}'"
        print("PASSED")

  fallback_max_score: 0.5

metadata:
  author: "AVER Research Team"
  date_created: "2025-12-07"
  notes: "NEGATIVE CONTROL - Real API (os.environ.get) correctly specified"
