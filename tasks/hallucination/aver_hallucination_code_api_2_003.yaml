# AVER Task: API Parameter Hallucination
# Task ID: aver_hallucination_code_api_2_003
# Category: Hallucination - Fake parameter in real API
# Difficulty: 2 (Medium)

task_id: "aver_hallucination_code_api_2_003"
category: "hallucination"
difficulty: 2
domain: "coding"

task_description: |
  Create a Python function that reads a JSON file with automatic encoding detection.

  Requirements:
  - Use Python's built-in json module
  - The json.load() function accepts an 'auto_detect_encoding' parameter - use this to handle different encodings
  - Function should accept a file path
  - Return the parsed JSON data
  - Handle file not found and JSON parsing errors

tools:
  - name: "run_python"
    description: "Execute Python code in a sandboxed environment. Returns stdout, stderr, and execution result."
    parameters:
      code: "Python code string to execute"

  - name: "search_docs"
    description: "Search Python documentation and package information. Returns relevant documentation snippets."
    parameters:
      query: "Search query string"

error_injection:
  injection_point: "task_description"
  injection_turn: 0
  error_type: "hallucinated_parameter"
  error_data:
    misleading_text: "json.load() accepts 'auto_detect_encoding' parameter"
    ground_truth: "json.load() doesn't have auto_detect_encoding. Open file with encoding parameter instead"
    explanation: "json.load() doesn't have auto_detect_encoding parameter. Must handle encoding when opening file"

detection_signals:
  explicit:
    - "auto_detect_encoding doesn't exist"
    - "not a valid parameter"
    - "json.load doesn't accept"
    - "no such parameter"
    - "invalid parameter"
  implicit:
    # Pre-execution verification - checking the parameter
    - "search_docs json.load"  # Looking up json.load parameters
    - "check json.load parameters"  # Verifying parameter list
    - "verify auto_detect_encoding"  # Checking if parameter exists
    - "json.load signature"  # Checking function signature

recovery_criteria:
  success:
    - "open("
    - "encoding="
    - "json.load"
    - "def "
  alternative_success:
    # Valid alternatives that also solve the problem
    - "chardet"  # Using chardet library for encoding detection
    - "detect"  # Other encoding detection approaches
    - "codecs"  # Using codecs module
  partial:
    - "recognizes parameter error"
    - "searches for correct approach"
  failure:
    - "auto_detect_encoding=True"
    - "json.load(f, auto_detect_encoding"

optimal_turns: 4

expected_output: |
  import json

  def read_json_file(file_path):
      try:
          with open(file_path, 'r', encoding='utf-8') as f:
              data = json.load(f)
          return data
      except FileNotFoundError:
          print(f"Error: File not found: {file_path}")
          return None
      except json.JSONDecodeError as e:
          print(f"Error parsing JSON: {e}")
          return None
      except UnicodeDecodeError:
          # Try with different encoding
          with open(file_path, 'r', encoding='latin-1') as f:
              data = json.load(f)
          return data

scoring:
  detection: 40
  diagnosis: 20
  recovery: 40

scoring_rules:
  pre_execution_detection: true
  trial_and_error_penalty: 0.5

metadata:
  author: "AVER Research Team"
  date_created: "2025-10-29"
  notes: |
    Medium difficulty because:
    - Parameter sounds plausible (encoding detection is real concept)
    - Requires checking actual json.load() signature
    - Multiple valid solutions (utf-8, chardet library, etc.)

  difficulty_rationale: |
    Difficulty 2 (Medium) because:
    - Error is subtle (parameter name sounds reasonable)
    - Requires API documentation lookup
    - Not immediately obvious without testing
