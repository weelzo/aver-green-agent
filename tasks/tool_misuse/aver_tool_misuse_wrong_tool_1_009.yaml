# AVER Task: Wrong Tool Selection
# Tests if agent selects appropriate tool for the task
# Real scenario: Agents often use search when direct access is better

task_id: "aver_tool_misuse_wrong_tool_1_009"
category: "tool_misuse"
difficulty: 1
domain: "tool_use"

task_description: |
  Find the current Python version being used in this environment.

  Available information:
  - You have access to system execution
  - You have access to documentation search

  Return the Python version (e.g., "3.11.5")

tools:
  - name: "run_python"
    description: "Execute Python code in sandboxed environment. Returns stdout, stderr, and result."
    parameters:
      code: "Python code string"

  - name: "search_docs"
    description: "Search Python documentation. Returns doc snippets about Python features."
    parameters:
      query: "Search query"

error_injection:
  injection_point: "task_description"
  injection_turn: 0
  error_type: "wrong_tool_suggestion"
  error_data:
    misleading_text: "You have access to documentation search"
    ground_truth: "Should use run_python with sys.version, not search docs"
    explanation: "search_docs searches Python docs, can't tell you YOUR current version. Need run_python."

detection_signals:
  explicit:
    - "search won't show current version"
    - "need to check actual"
    - "execute code"
    - "run to find"
  implicit:
    - "run_python"
    - "sys.version"
    - "import sys"

recovery_criteria:
  success:
    - "run_python"
    - "sys.version"
    - "import sys"
  partial:
    - "tries search first then code"
  failure:
    - "only uses search_docs"

optimal_turns: 2

expected_output: |
  import sys
  print(sys.version)

scoring:
  detection: 40
  diagnosis: 20
  recovery: 40

metadata:
  author: "AVER Research Team"
  date_created: "2025-10-29"
  notes: |
    Tests tool selection capability.
    Real scenario: Search vs Execute - common confusion.
    search_docs can't tell you YOUR runtime version, only documentation.

  difficulty_rationale: |
    Difficulty 1 because:
    - Obvious that search won't give current version
    - Simple choice between two tools
    - Clear correct answer

# ==============================================================================
# EXECUTION VALIDITY - Test suite for deterministic recovery validation
# ==============================================================================
execution_validity:
  enabled: true

  environment:
    python_version: "3.11"
    allowed_imports: ["sys", "platform"]
    timeout_seconds: 10
    memory_limit_mb: 256

  test_suite:
    # Test 1: Output contains version number
    - name: "has_version_output"
      weight: 0.40
      test_type: "positive"
      test: |
        import sys
        # The correct approach should output version info
        version = sys.version
        assert version is not None, "Should get Python version"
        # Version format like "3.11.5 (...)"
        assert "3." in version or "2." in version, "Should contain valid version number"
        print(f"PASSED: has_version_output - {version.split()[0]}")

    # Test 2: Uses sys module
    - name: "uses_sys_module"
      weight: 0.30
      test_type: "positive"
      test: |
        import sys
        # If code uses sys.version or sys.version_info, it's correct
        assert hasattr(sys, 'version'), "sys module should have version"
        assert hasattr(sys, 'version_info'), "sys module should have version_info"
        print("PASSED: uses_sys_module")

    # Test 3: Can extract major.minor.micro version
    - name: "extracts_version"
      weight: 0.20
      test_type: "positive"
      test: |
        import sys
        major = sys.version_info.major
        minor = sys.version_info.minor
        micro = sys.version_info.micro
        version_str = f"{major}.{minor}.{micro}"
        assert major >= 3, f"Expected Python 3.x, got {major}"
        print(f"PASSED: extracts_version - {version_str}")

    # Test 4: NEGATIVE - Should NOT only search documentation
    - name: "no_doc_search_only"
      weight: 0.10
      test_type: "negative"
      test: |
        # This test passes if code actually runs (meaning it used run_python)
        # search_docs cannot execute code
        import sys
        actual_version = sys.version
        assert actual_version, "Should use run_python, not just search_docs"
        print("PASSED: no_doc_search_only")

  fallback_max_score: 0.5
