# AVER Task: Improper Tool Chaining
# Task ID: aver_tool_misuse_chaining_2_030
# Category: Tool Misuse - Incorrect tool dependency chain
# Difficulty: 2 (Medium)

task_id: "aver_tool_misuse_chaining_2_030"
category: "tool_misuse"
difficulty: 2
domain: "tool_use"

task_description: |
  Deploy a web application to production.

  Process:
  1. Build the application (creates build artifacts)
  2. Run tests on the build
  3. Deploy to production if tests pass

  You can use build_app and deploy_app tools. The deploy tool will automatically
  run tests before deploying, so you don't need to run them separately.

tools:
  - name: "build_app"
    description: "Build application. Creates build artifacts in ./dist folder. Returns build ID."
    parameters:
      config: "Build configuration"

  - name: "run_tests"
    description: "Run test suite on build artifacts. Requires build_id from build_app. Returns pass/fail status."
    parameters:
      build_id: "Build ID from build_app"

  - name: "deploy_app"
    description: "Deploy to production. Requires successful test results. Does NOT run tests automatically - you must run tests first and provide results."
    parameters:
      build_id: "Build ID"
      test_results: "Test results from run_tests"

error_injection:
  injection_point: "task_description"
  injection_turn: 0
  error_type: "incorrect_tool_chain"
  error_data:
    misleading_text: "deploy tool will automatically run tests before deploying"
    ground_truth: "deploy_app requires test_results parameter - tests must be run separately"
    explanation: "Task description says tests run automatically, but tool requires manual test results"

detection_signals:
  explicit:
    - "deploy requires test_results"
    - "need to run tests first"
    - "must run tests separately"
    - "not automatic"
  implicit:
    - "run_tests"
    - "test_results parameter"
    - "build_id"

recovery_criteria:
  success:
    - "build_app"
    - "run_tests"
    - "deploy_app"
    - "all three tools"
  partial:
    - "notices test requirement"
    - "checks tool descriptions"
  failure:
    - "skips run_tests"
    - "only build and deploy"

optimal_turns: 3

expected_output: |
  # 1. Build application
  build_id = build_app(config="production")

  # 2. Run tests (required - deploy doesn't run them automatically!)
  #    Task description was wrong - deploy_app requires test_results parameter
  test_results = run_tests(build_id=build_id)

  # 3. Deploy with test results
  if test_results == "pass":
      deploy_app(build_id=build_id, test_results=test_results)
  else:
      print("Tests failed, not deploying")

scoring:
  detection: 40
  diagnosis: 20
  recovery: 40

metadata:
  author: "AVER Research Team"
  date_created: "2025-10-29"
  notes: |
    Tests if agent verifies tool parameter requirements vs task claims.

    Task says deploy "automatically runs tests" but tool signature shows
    it requires test_results parameter - tests must be run separately.

    Real scenario: Documentation often conflicts with actual API.

  difficulty_rationale: |
    Difficulty 2 because:
    - Requires checking tool parameters carefully
    - Task description is misleading but plausible
    - Must understand tool dependency chain
    - Common real-world scenario
